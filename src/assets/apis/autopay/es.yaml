openapi: 3.0.0
info:
  title: BETA - API de AutoPay - Solicitud de Balance
  version: 1.0.0
paths:
  /autopay/balance:
    post:
      summary: Obtener balance
      operationId: post-balance
      parameters:
        - schema:
            type: string
            example: application/json;charset=UTF-8
          in: header
          name: Content-Type
      responses:
        "200":
          description: Respuesta satisfactoria con el monto a cobrar al usuario
          content:
            application/json:
              schema:
                type: object
                required: [ status, id, amount ]
                properties:
                  status:
                    $ref: '#/components/schemas/Status'
                  id:
                    $ref: '#/components/schemas/AutoPayId'
                  amount:
                    $ref: "../base/es.yaml#/components/schemas/Amount"
                  min_amount:
                    $ref: "../base/es.yaml#/components/schemas/Amount"
        "4XX":
          description: Error en la solicitud.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    $ref: '#/components/schemas/Status'
      description: 'Este endpoint devuelve un monto pendiente de cobro y el monto mínimo requerido para ejecutar el auto pago.'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [ auth, reference, id ]
              properties:
                auth:
                  $ref: '#/components/schemas/Authentication'
                reference:
                  type: string
                  description: Referencia del AutoPago proporcionada por el cliente/comercio, esta referencia debe ser unica activa por comercio.
                  example: "ACC00012345"
                  maxLength: 32
                id:
                  $ref: '#/components/schemas/AutoPayId'
  /autopay/settlement:
    post:
      summary: Asentar un AutoPago
      operationId: post-settlement
      parameters:
        - schema:
            type: string
            example: application/json;charset=UTF-8
          in: header
          name: Content-Type
      responses:
        "200":
          description: Autopago registrado correctamente.
          content:
            application/json:
              schema:
                type: object
                required: [ status, id ]
                properties:
                  status:
                    $ref: '#/components/schemas/Status'
                  id:
                    $ref: '#/components/schemas/AutoPayId'
        "4XX":
          description: Error en la solicitud.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Status'
      description: 'Este endpoint registra y retorna únicamente el estado de la notificación (settlement).'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [ reference, id, transaction ]
              properties:
                auth:
                  $ref: '#/components/schemas/Authentication'
                reference:
                  type: string
                  description: Referencia del AutoPago proporcionada por el cliente/comercio, esta referencia debe ser unica activa por comercio.
                  minLength: 32
                  maxLength: 32
                  example: "ACC00012345"
                id:
                  $ref: '#/components/schemas/AutoPayId'
                transaction:
                  $ref: "../base/es.yaml#/components/schemas/Transaction"
  /autopay/webhook:
    post:
      summary: Recepción de notificaciones AutoPay
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WebhookEvent'
      responses:
        "200":
          description: El webhook fue recibido correctamente.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    $ref: '#/components/schemas/Status'
        "4XX":
          description: Ha ocurrido un error al recibir el Webhook.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    $ref: "#/components/schemas/Status"
  /gateway/autopay/search:
    post:
      summary: Listar autopagos
      operationId: post-search
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - auth
              properties:
                auth:
                  $ref: '#/components/schemas/Authentication'
                filters:
                    type: object
                    description: Criterios de filtrado para la búsqueda.
                    properties:
                      reference:
                        type: string
                        description: Referencia del AutoPago proporcionada por el cliente/comercio, esta referencia debe ser unica activa por comercio.
                        example: "ACC00012345"
                        maxLength: 32
                      id:
                        $ref: '#/components/schemas/AutoPayId'
                      chargeTypes:
                        type: array
                        description: Filtrar por uno o varios tipos de cargo.
                        items:
                          $ref: '#/components/schemas/ChargeType'
                      status:
                        type: array
                        description: Estados del AutoPago incluidos en el filtro.
                        items:
                          type: string
                          enum:
                              - OK
                              - FAILED
                              - REJECTED
                              - APPROVED
                        example: [ "APPROVED", "PENDING" ]
                      createdAt:
                          type: object
                          description: Rango de fechas de creación (ISO 8601, solo fecha).
                          properties:
                            from:
                              type: string
                              example: "2025-09-01"
                            to:
                              type: string
                              example: "2025-09-30"
                pagination:
                  $ref: '#/components/schemas/PaginationRequest'
                locale:
                  $ref: '#/components/schemas/Locale'
      responses:
        "200":
          description: Solicitud exitosa
          content:
            application/json:
              schema:
                type: object
                required:
                  - status
                properties:
                  status:
                    $ref: '#/components/schemas/Status'
                  data:
                    description: Lista de autopagos que cumplen con los criterios de búsqueda.
                    type: array
                    items:
                      $ref: '#/components/schemas/AutoPay'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
  /gateway/autopay/cancel:
    post:
      summary: Cancelar un autopago
      operationId: post-search
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - auth
                - id
              properties:
                auth:
                  $ref: '#/components/schemas/Authentication'
                id:
                  $ref: '#/components/schemas/AutoPayId'
                locale:
                  $ref: '#/components/schemas/Locale'
      responses:
        "200":
          description: Solicitud exitosa
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    $ref: '#/components/schemas/Status'
                  id:
                    $ref: '#/components/schemas/AutoPayId'
        "4XX":
          description: Solicitud inválida
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    $ref: '#/components/schemas/Status'
  /gateway/autopay/create:
    post:
      summary: Crear un autopago
      operationId: post-search
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - auth
                - reference
                - chargeTypes
              properties:
                auth:
                  $ref: '#/components/schemas/Authentication'
                subscriptor:
                  $ref: '../base/es.yaml#/components/schemas/Person'
                  description: Estructura que contiene la información del suscriptor (pagador) del AutoPago. Si no se envía, el sistema solicitará esta información al usuario en la interfaz gráfica.
                subscription:
                  type: object
                  required:
                    - reference
                    - description
                    - recurring
                  description: Estructura que contiene la información acerca de la suscripción asociada al AutoPago.
                  properties:
                    reference:
                      type: "string"
                      minLength: 1
                      maxLength: 32
                    description:
                      type: "string"
                      maxLength: 250
                    amount:
                      $ref: "../base/es.yaml#/components/schemas/Amount"
                      description: |
                        Estructura que define la información asociada al pago recurrente dentro del proceso de autopago. El valor y comportamiento de este campo dependen del tipo de cargo seleccionado por el usuario (chargeType) y de la configuración del comercio:
                        - Si el tipo de cargo es FIXED, el valor definido en este campo representará el monto que se cobrará de forma recurrente.
                        - Si el tipo de cargo es TOTAL_BALANCE o MINIMUM_BALANCE, este valor será ignorado, ya que el monto será determinado automáticamente con base en el estado de cuenta del usuario ([Balance](/autopay/contracts/balance)).
                        En caso de no enviarse este campo y el tipo de cargo seleccionado lo requiera, el sistema solicitará al usuario completar la información correspondiente a través de la interfaz gráfica.
                      x-conditional:
                        - "currency"
                        - "total"
                    recurring:
                      $ref: "#/components/schemas/Recurring"
                chargeTypes:
                  type: array
                  description: |
                    Tipos de cargo permitidos dentro del autopago. Debe incluir al menos un tipo. En el caso de existir un solo tipo, este se tomará por defecto y se aplicará la lógica correspondiente al monto y configuración del comercio; si por el contrario existen varios tipos, en la redirección a la interfaz gráfica se le solicitará al usuario (pagador) escoger un tipo de cargo de los seleccionados por el cliente. Ver más en [Tipos de cargo](/autopay/charge-types).
                    - Actualmente solo será permitido seleccionar un item.
                  minItems: 1
                  maxItems: 1
                  enum:
                    - TOTAL_BALANCE
                    - MINIMUM_BALANCE
                    - FIXED
                  example:
                    - [ "TOTAL_BALANCE" ]
                additional:
                  type: object
                  description: Información adicional.
                  properties:
                    customerAccountNumber:
                      type: string
                      example: "12345"
                expiration:
                    type: string
                    format: date-time
                    description: Fecha de expiración de la sesión/solicitud.
                    example: "2025-12-15T00:00:00-05:00"
                returnUrl:
                    type: string
                    format: uri
                    maxLength: 255
                    description: URL de retorno post-proceso (longitud máxima actual 255).
                    example: "https://dnetix.co/p2p/client"
                cancelUrl:
                  type: string
                  description: |
                    URL de cancelación, a esta url se redirige al usuario cuando decide no continuar con el proceso.
                    Ocurre cuando el usuario da click en _No deseo continuar_
                  example: 'https://commerce.test/cancel'
                skipResult:
                  type: boolean
                  description: |
                    Si se envía `true`, cuando el usuario finalice el proceso no se mostrará la página de resultado de sesión, en su lugar será redireccionado al `returnUrl`. Ver más en [Omitir resultado](/checkout/skip-result)
                  default: false
                locale:
                  $ref: '#/components/schemas/Locale'
      responses:
        "200":
          description: Solicitud exitosa
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    $ref: '#/components/schemas/Status'
                  id:
                    $ref: '#/components/schemas/AutoPayId'
                  processUrl:
                    type: string
                    format: uri
                    description: URL de redirección para completar el proceso de creación.
                    example: "https://checkout-co.placetopay.com/session/1/cc9b8690b1f7228c78b759ce27d7e80a/edit"
        "4XX":
          description: Solicitud inválida
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    $ref: '#/components/schemas/Status'
  /gateway/autopay/edit:
    post:
      summary: Actualizar un autopago
      operationId: post-edit
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - auth
                - id
              properties:
                auth:
                  $ref: '#/components/schemas/Authentication'
                id:
                  $ref: '#/components/schemas/AutoPayId'
                expiration:
                    type: string
                    format: date-time
                    description: Fecha de expiración de la sesión/solicitud.
                    example: "2025-12-15T00:00:00-05:00"
                returnUrl:
                  type: string
                  format: uri
                  maxLength: 255
                  description: URL de retorno post-proceso (longitud máxima actual 255).
                  example: "https://dnetix.co/p2p/client"
                cancelUrl:
                  type: string
                  description: |
                    URL de cancelación, a esta url se redirige al usuario cuando decide no continuar con el proceso.
                    Ocurre cuando el usuario da click en _No deseo continuar_
                  example: 'https://commerce.test/cancel'
                skipResult:
                  type: boolean
                  description: |
                    Si se envía `true`, cuando el usuario finalice el proceso no se mostrará la página de resultado de sesión, en su lugar será redireccionado al `returnUrl`. Ver más en [Omitir resultado](/checkout/skip-result)
                  default: false
                locale:
                  $ref: '#/components/schemas/Locale'
      responses:
        "200":
          description: Solicitud exitosa
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    $ref: '#/components/schemas/Status'
                  id:
                    $ref: '#/components/schemas/AutoPayId'
                  processUrl:
                    type: string
                    format: uri
                    description: URL de redirección para completar el proceso de actualización.
                    example: "https://checkout-co.placetopay.com/session/1/cc9b8690b1f7228c78b759ce27d7e80a/edit"
        "400":
          description: Solicitud inválida
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    $ref: '#/components/schemas/Status'
        "401":
          description: Autenticación fallida
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    $ref: '#/components/schemas/Status'
  /gateway/autopay/transactions:
    post:
      summary: Listar transacciones de un autopago
      operationId: post-search
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - auth
                - id
              properties:
                auth:
                  $ref: '#/components/schemas/Authentication'
                id:
                  $ref: '#/components/schemas/AutoPayId'
                filters:
                  type: object
                  description: Criterios de filtrado para la búsqueda.
                  properties:
                    internalReference:
                      type: string
                      description: Referencia interna de la transacción en placetopay proporcionada por la pasarela en el momento del pago.
                      example: "ACC00012345"
                      maxLength: 32
                    status:
                      type: array
                      description: Estados de la transacción.
                      items:
                        type: string
                        enum:
                          - OK
                          - FAILED
                          - REJECTED
                          - APPROVED
                          - APPROVED_PARCIAL
                      example: [ "APPROVED", "PENDING" ]
                    amount:
                      type: "object"
                      description: "Estructura que contiene la información acerca del pago de la transacción."
                      required:
                        - "currency"
                        - "total"
                      properties:
                        currency:
                          type: "string"
                          description: |
                            Código alfabético de la moneda a usar (ISO 4217 alpha code)
                          enum:
                            - "USD"
                            - "COP"
                            - "CRC"
                            - "EUR"
                            - "CAD"
                            - "AUD"
                            - "GBP"
                            - "MXN"
                            - "CLP"
                          example: "COP"
                          minLength: 3
                          maxLength: 3
                        total:
                          type: "number"
                          example: 2000
                          description: |
                            Valor total en la moneda base indicada
                    createdAt:
                      type: object
                      description: Rango de fechas de creación (ISO 8601, solo fecha).
                      properties:
                        from:
                          type: string
                          example: "2025-09-01"
                        to:
                          type: string
                          example: "2025-09-30"
                pagination:
                  $ref: '#/components/schemas/PaginationRequest'
                locale:
                  $ref: '#/components/schemas/Locale'
      responses:
        "200":
          description: Solicitud exitosa
          content:
            application/json:
              schema:
                type: object
                required:
                  - status
                properties:
                  status:
                    $ref: '#/components/schemas/Status'
                  data:
                    description: Lista de transacciones del autopago que cumplen con los criterios de búsqueda.
                    type: array
                    items:
                      title: Transaction
                      $ref: '../base/es.yaml#/components/schemas/Transaction'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
components:
  schemas:
    AutoPay:
      type: object
      required:
        - id
        - status
        - subscription
        - createdAt
      properties:
        id:
          $ref: '#/components/schemas/AutoPayId'
        status:
          $ref: '#/components/schemas/StatusAutoPay'
        subscriptor:
          $ref: '../base/es.yaml#/components/schemas/Person'
        subscription:
          type: object
          required:
            - reference
            - description
            - recurring
          description: Estructura que contiene la información acerca de la suscripción asociada al AutoPago.
          properties:
            reference:
              type: "string"
              minLength: 1
              maxLength: 32
            description:
              type: "string"
              maxLength: 250
            amount:
              $ref: "../base/es.yaml#/components/schemas/Amount"
              description: |
                Solo presente cuando el tipo de cargo sea `FIXED`.
                - `FIXED`: monto recurrente a cobrar.
            recurring:
              $ref: "#/components/schemas/Recurring"
        additional:
          type: object
          description: Información adicional.
          properties:
            customerAccountNumber:
              type: string
              example: "12345"
        acceptedAt:
          type: string
          format: date-time
          description: Fecha en la que el usuario aceptó el AutoPago.
          example: "2021-09-24T10:02:17-05:00"
        createdAt:
          type: string
          format: date-time
          description: Fecha de creación del AutoPago.
          example: "2021-09-24T10:02:17-05:00"
        updatedAt:
          type: string
          format: date-time
          description: Fecha de la última actualización del AutoPago.
          example: "2021-09-24T10:02:17-05:00"
    ChargeType:
      type: string
      enum:
        - TOTAL_BALANCE
        - MINIMUM_BALANCE
        - FIXED
      description: Tipo de cargo del autopago. Ver más en [Tipos de cargo](/autopay/charge-types).
    AutoPayId:
      type: string
      format: uuid
      description: Identificador único del autopago confirmado en el registro de la notificación.
      minLength: 36
      maxLength: 36
      example: "2972c13d-6315-4da3-80d7-64c24eb232ad"
    Recurring:
      type: object
      description: Parámetros de recurrencia. En caso de no enviarse en la solicitud de creación, el sistema podrá solicitarlos al usuario en el momento de la redirección.
      properties:
        type:
          $ref: '#/components/schemas/ChargeType'
        periodicity:
          type: string
          description: Periodicidad del cobro. D=Diario, W=Semanal, M=Mensual, Y=Anual.
          enum: [ D, W, M, Y ]
          example: M
        interval:
          type: string
          description: Cada cuántos períodos se realiza el cobro (ej. "1" = cada mes si periodicidad=M).
          pattern: '^[1-9][0-9]*$'
          example: "1"
        maxPeriods:
          type: integer
          description: Número máximo de períodos a cobrar.
          minimum: 1
          example: 12
        dueDate:
          type: string
          format: date
          description: Fecha de vencimiento de la recurrencia
          example: '2019-09-24'
        nextPayment:
          type: string
          description: Fecha a partir de la cual inicia el cobro.
          format: date
          example: "2025-11-30"
    WebhookEvent:
      type: object
      required: [ auth, reference, id, type, date ]
      x-conditional: [ data ]
      properties:
        auth:
          $ref: '#/components/schemas/Authentication'
        reference:
          type: string
          description: Referencia del AutoPago proporcionada por el cliente/comercio, esta referencia debe ser unica activa por comercio.
          example: "ACC00012345"
          maxLength: 32
        id:
          type: string
          format: uuid
          description: Identificador único del AutoPago
          minLength: 36
          maxLength: 36
          example: "2972c13d-6315-4da3-80d7-64c24eb232ad"
        type:
          type: string
          enum:
            - AUTOPAY_UPDATED
            - AUTOPAY_FAILED
            - AUTOPAY_CANCELED
          description: "Tipo de evento notificado. Ver más en [Eventos Webhook](/autopay/webhook-description#event-types)."
        date:
          type: string
          format: date-time
          description: Fecha y hora en la que se lanzó por primera vez el evento. En formato ISO 8601.
          example: "2025-09-29T17:09:29-05:00"
        data:
          type: object
          description: Objeto que contiene información relevante para identificar el autopago e información del evento.
          x-conditional:
            transactionId
            reason
          properties:
            transactionId:
              type: string
              format: uuid
              minLength: 36
              maxLength: 36
              description: Identificador del pago ejecutado. Puede venir cuando el evento es AUTOPAY_FAILED.
              example: "2972c13d-6315-4da3-80d7-64c24eb232ad"
            reason:
              type: string
              minLength: 2
              maxLength: 2
              description: Código de razón de actualización del autopago. Puede venir cuando el evento es AUTOPAY_FAILED, AUTOPAY_CANCELED. Ver más en [Códigos de razón](/autopay/codes).
              example: "XA"
    Status:
      title: Status
      type: object
      description: Estructura para definir estados de respuestas
      x-internal: false
      properties:
        status:
          type: string
          enum:
            - OK
            - FAILED
            - REJECTED
          description: Estado de la petición.
        reason:
          type: string
          enum:
            - 100
            - 101
            - 102
            - 103
            - 104
            - '00'
            - BR
            - X3
            - XH
            - ?-
            - '05'
            - NF
          description: Razón del estado de la petición. (consulte en [Códigos de razón](/autopay/codes))
          example: '00'
        message:
          type: string
          description: Mensaje para aclarar el estado.
          example: "Respuesta satisfactoria"
        date:
          type: string
          format: date-time
          description: Fecha y hora en la que se generó la respuesta.
          example: "2025-09-29T17:09:29-05:00"
      required:
        - status
        - reason
        - message
    StatusAutoPay:
      title: Status
      type: object
      description: Estructura para definir el estado del autopago
      x-internal: false
      properties:
        status:
          type: string
          enum: [ APPROVED, REJECTED, PENDING, FAILED ]
          example: APPROVED
          description: Estado del autopago.
        reason:
          type: string
          enum:
            - 100
            - 101
            - 102
            - 103
            - 104
            - '00'
            - BR
            - X3
            - XH
            - ?-
            - '05'
            - NF
          description: Razón del estado de la petición. (consulte en [Códigos de razón](/autopay/codes))
          example: '00'
        message:
          type: string
          description: Mensaje para aclarar el estado.
          example: "Respuesta satisfactoria"
        date:
          type: string
          format: date-time
          description: Fecha y hora en la que se generó la respuesta.
          example: "2025-09-29T17:09:29-05:00"
      required:
        - status
        - reason
        - message
    Pagination:
      title: Pagination
      type: object
      description: Estructura que contiene la información de la paginación.
      required:
        - total
        - perPage
        - currentPage
        - lastPage
      properties:
        total:
          type: integer
          example: 30
          minimum: 1
          description: Número total de registros encontrados en la consulta.
        perPage:
          type: integer
          default: 15
          example: 10
          minimum: 1
          description: Número de registros por página
        currentPage:
          type: integer
          default: 1
          minimum: 1
          example: 1
          description: Página actual
        lastPage:
          type: integer
          minimum: 1
          example: 1
          description: Ultima página disponible
    Locale:
      type: "string"
      description: "Idioma de la respuesta."
      example: "es_ES"
    PaginationRequest:
      title: Pagination
      type: object
      description: Estructura que contiene la información de la paginación.
      properties:
        perPage:
          type: integer
          default: 15
          example: 10
          minimum: 1
          description: Número de registros por página
        currentPage:
          type: integer
          default: 1
          minimum: 1
          example: 1
          description: Página actual
    Authentication:
      required:
        - login
        - tranKey
        - nonce
        - seed
      title: "Autenticación"
      type: "object"
      properties:
        login:
          type: "string"
          description: Identificador del **sitio**
        tranKey:
          type: "string"
          description: Credencial **tranKey** generado. Ver más en [Autenticación](/autopay/authentication/#how-to-generate-your-authentication)
        nonce:
          type: "string"
          description: Valor **aleatorio** para cada solicitud codificado en **Base64**.
        seed:
          type: "string"
          description: Fecha **actual**, la cual se genera en formato **ISO 8601**.
      description: "Estructura que contiene la información de autenticación del *sitio* generada de acuerdo al WSSE
        UsernameToken Profile 1.1. Ver más en [Autenticación](/autopay/authentication)."