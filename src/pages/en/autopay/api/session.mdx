import { HeroPattern } from '@/components/HeroPattern'

<HeroPattern />

export const apiRefs = ['/autopay/session','/autopay/session/{requestId}']


## Create or update an AutoPay session {{ id: 'session-autopay', tag: 'POST', label: '/autopay/session' }}

The AutoPay creation and update flow begins with this request, which generates a session. This process allows configuring scheduled and/or recurring payments in an automated manner, providing a link to redirect to the graphical interface so that the cardholder can authorize the start or update of the autopay and select the payment method.

## Creation flow

1. **Initial request**: When the creation request is made, the system generates an AutoPay session and returns a redirect URL.

2. **AutoPay interface**: The URL redirects the user to a graphical interface where they must:
- Accept the autopay terms and conditions
- Select their preferred payment method
- Complete the payment method subscription process
- Pass the required security validations

3. **Activation**: Once the process is completed, you will receive a notification via webhook indicating the creation of the autopay. Alternatively, you can check the status using the session query endpoint to verify whether the autopay has already been created.



---

## Create a session {{ id: 'create-a-session', tag: 'POST', label: '/autopay/session' }}

<Row>
  <Col>
    This endpoint allows you to create a new session. Within the session, the user will be able to complete a subscription.
    <ApiReader
      path="/autopay/session"
      method="post"
      api={props.refs}
    />

  </Col>
  <Col sticky>
    <CodeGroup title="Request" tag="POST" label="/autopay/session">

```bash {{ title: 'Session to create auto-payment - Fixed Amount' }}
curl -X "POST" https://test.placetopay.com/autopay/session \
  -H "Content-Type: application/json" \
  -d '{
    "auth": {
      "login": "aabbccdd1234567890aabbccdd123456",
      "tranKey": "ABC123example456trankey+789abc012def3456ABC=",
      "nonce": "NjE0OWVkODgwYjNhNw==",
      "seed": "2021-09-21T09:34:48-05:00"
    },
    "type": "autopay",
    "autopay": {
      "action": "CREATE",
      "reference": "12345",
      "description": "Inscripción autopago monto fijo",
      "dueDay": 15,
      "recurring": {
        "type": "FIXED",
        "periodicity": "M",
        "interval": "1",
        "maxPeriods": 12,
        "startDate": "2026-11-26",
        "nextPayment": "2026-12-05",
        "dueDate": "2027-11-26",
        "notificationUrl": "https://merchant.test/notification",
      },
      "amount": {
        "currency": "USD",
        "total": 100
      }
    },
    "returnUrl": "https://merchant.test/return",
    "ipAddress": "127.0.0.1",
    "userAgent": "PlacetoPay Sandbox",
  }'
```

```bash {{ title: 'Session to create auto-payment - Total Amount' }}
curl -X "POST" https://test.placetopay.com/autopay/session \
  -H "Content-Type: application/json" \
  -d '{
    "auth": {
      "login": "aabbccdd1234567890aabbccdd123456",
      "tranKey": "ABC123example456trankey+789abc012def3456ABC=",
      "nonce": "NjE0OWVkODgwYjNhNw==",
      "seed": "2021-09-21T09:34:48-05:00"
    },
    "type": "autopay",
    "autopay": {
      "action": "CREATE",
      "reference": "12345",
      "description": "Inscripción autopago monto fijo",
      "dueDay": 15
      "recurring": {
        "type": "TOTAL_BALANCE",
        "periodicity": "M",
        "interval": "1",
        "maxPeriods": 12,
        "startDate": "2026-11-26",
        "nextPayment": "2026-12-05",
        "dueDate": "2027-11-26",
        "notificationUrl": "https://merchant.test/notification",
      }
    },
    "returnUrl": "https://merchant.test/return",
    "ipAddress": "127.0.0.1",
    "userAgent": "PlacetoPay Sandbox",
  }'
```

```bash {{ title: 'Session to create auto-payment - Minimum Amount' }}
curl -X "POST" https://test.placetopay.com/autopay/session \
  -H "Content-Type: application/json" \
  -d '{
    "auth": {
      "login": "aabbccdd1234567890aabbccdd123456",
      "tranKey": "ABC123example456trankey+789abc012def3456ABC=",
      "nonce": "NjE0OWVkODgwYjNhNw==",
      "seed": "2021-09-21T09:34:48-05:00"
    },
    "type": "autopay",
    "autopay": {
      "action": "CREATE",
      "reference": "12345",
      "description": "Inscripción autopago monto fijo",
      "dueDay": 15
      "recurring": {
        "type": "MINIMUM_BALANCE",
        "periodicity": "M",
        "interval": "1",
        "maxPeriods": 12,
        "startDate": "2026-11-26",
        "nextPayment": "2026-12-05",
        "dueDate": "2027-11-26",
        "notificationUrl": "https://merchant.test/notification",
      }
    },
    "returnUrl": "https://merchant.test/return",
    "ipAddress": "127.0.0.1",
    "userAgent": "PlacetoPay Sandbox",
  }'
```

```bash {{ title: 'Session to edit self-checkout' }}
curl -X "POST" https://test.placetopay.com/autopay/session \
  -H "Content-Type: application/json" \
  -d '{
    "auth": {
      "login": "aabbccdd1234567890aabbccdd123456",
      "tranKey": "ABC123example456trankey+789abc012def3456ABC=",
      "nonce": "NjE0OWVkODgwYjNhNw==",
      "seed": "2021-09-21T09:34:48-05:00"
    },
    "type": "autopay",
    "autopay": {
      "action": "EDIT",
      "reference": "12345",
      "description": "Inscripción autopago monto fijo",
      "id": "f7b347d7-c922-4c68-8750-99fb43c9e5ff"
    },
    "returnUrl": "https://merchant.test/return",
    "ipAddress": "127.0.0.1",
    "userAgent": "PlacetoPay Sandbox",
  }'
```
    </CodeGroup>
  </Col>
</Row>

<Row>
  <Col>
    <ApiReader
      path="/autopay/session"
      method="post"
      type="response"
      api={props.refs}
    />
  </Col>

  <Col sticky>
    <br />
    <CodeGroup title="Response">
```json {{ title: '200' }}
{
  "status": {
    "status": "OK",
    "reason": "PC",
    "message": "The request has been processed successfully",
    "date": "2021-11-30T15:08:27-05:00"
  },
  "requestId": 1,
  "processUrl": "https://checkout-co.placetopay.com/session/1/cc9b8690b1f7228c78b759ce27d7e80a",
}
```
```json {{ title: '400' }}
{
  "status": {
    "status": "FAILED",
    "reason": 401,
    "message": "Autenticación fallida 102",
    "date": "2021-11-30T15:12:25-05:00"
  },
}
```
    </CodeGroup>
  </Col>
</Row>


---

---

## Query a session {{ id: 'query-a-session', tag: 'POST', label: '/autopay/session/:requestId' }}

<Row>
  <Col>
        This endpoint allows you to obtain session information; if there are transactions in the session, the details of those transactions are displayed.
    <ApiReader
      path="/autopay/session/{requestId}"
      type="params"
      api={props.refs}
    />
  </Col>
</Row>

<br />

<Row>
  <Col>
    <ApiReader
      path="/autopay/session/{requestId}"
      method="post"
      api={props.refs}
    />

  </Col>
  <Col sticky>
    <CodeGroup title="Request" tag="POST" label="/autopay/session/:requestId">
```bash {{ title: 'cURL' }}
curl -X "POST" https://test.placetopay.com/autopay/session/000000 \
  -H "Content-Type: application/json" \
  -d '{
      "auth": {
        "login": "aabbccdd1234567890aabbccdd123456",
        "tranKey": "ABC123example456trankey+789abc012def3456ABC=",
        "nonce": "NjE0OWVkODgwYjNhNw==",
        "seed": "2021-09-21T09:34:48-05:00"
      }
    }'
```
    </CodeGroup>
  </Col>
</Row>

<Row>
  <Col>
    <ApiReader
      path="/autopay/session/{requestId}"
      method="post"
      type="response"
      api={props.refs}
    />
  </Col>

  <Col sticky>
    <br />
    <CodeGroup title="Response">

```json {{ title: '200: Registered Self-Pay'}}
{
  "status": {
    "status": "APPROVED",
    "reason": "00",
    "message": "La petición ha sido aprobada exitosamente",
    "date": "2022-07-27T14:51:27-05:00"
  },
  "requestId": 100,
  "request": {
    "locale": "es_CO",
    "payer": {
      "document": "111111111",
      "documentType": "CC",
      "name": "Antonino",
      "surname": "Pan y queso",
      "email": "root13@app.com",
      "mobile": "+573111111111"
    },
    "type": "autopay",
    "autopay": {
      "action": "CREATE",
      "reference": "12345",
      "description": "Inscripción autopago monto fijo",
      "recurring": {
        "type": "FIXED",
        "periodicity": "M",
        "interval": "1",
        "maxPeriods": 12,
        "startDate": "2026-11-26",
        "nextPayment": "2026-12-05",
        "dueDate": "2027-11-26",
        "notificationUrl": "https://merchant.test/notification",
      },
      "dueDay": 15,
      "amount": {
        "currency": "USD",
        "total": 100
      }
    },
    "fields": [
      {
        "keyword": "customerAccountNumber",
        "value": "112233",
        "displayOn": "none"
      }
    ],
    "returnUrl": "https://mysite.com/response/32120",
    "ipAddress": "127.0.0.1",
    "userAgent": "PlacetoPay Sandbox",
    "expiration": "2023-03-09T23:28:43.775Z"
  },
  "autopay": [
    {
      "status": {
          "status": "APPROVED",
          "reason": "00",
          "date":"2023-06-21T09:56:06-05:00"
      },
      "siteId": "100200300",
      "id": "328eb09a-363f-48a6-a16e-51c5a58b89ec",
      "buyer": null,
      "payer": {
        "document": "111111111",
        "documentType": "CC",
        "name": "Antonino",
        "surname": "Pan y queso",
        "email": "root13@app.com",
        "mobile": "+573111111111"
      },
      "subscription": {
        "reference": "12345",
        "description": "Inscripción autopago monto fijo",
        "amount": {
          "currency": "USD",
          "total": 100
        },
        "recurring": {
          "type": "FIXED",
          "periodicity": "M",
          "interval": "1",
          "maxPeriods": 12,
          "startDate": "2026-11-26",
          "nextPayment": "2026-12-05",
          "dueDate": "2027-11-26",
          "notificationUrl": "https://merchant.test/notification",
        },
      },
      "instrument": {
        "token": {
          "token": "faketoken12f233bd8f5d42138d681bf07ea8295429df07a4af287703e30c891",
          "subtoken": "fakesubtoken00000",
          "franchise": "master",
          "franchiseName": "Mastercard",
          "lastDigits": "0000",
          "validUntil": "2018-12-31"
        }
      },
      "additional": {
        "customerAccountNumber": "1232312323",
        "dueDay": "25",
      },
      "acceptedAt": "2021-09-24T10:02:17-05:00"
    },
  ],
  "payment": null,
  "subscription": null,
}
```

```json {{ title: '401' }}
{
  "status": {
    "status": "FAILED",
    "reason": 401,
    "message": "Autenticación fallida 102",
    "date": "2021-11-30T15:12:25-05:00"
  },
}
```
    </CodeGroup>
  </Col>
</Row>

---