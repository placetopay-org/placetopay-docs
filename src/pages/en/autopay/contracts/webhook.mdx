import { HeroPattern } from '@/components/HeroPattern'

<HeroPattern />

export const apiRefs = ['/autopay/webhook']

# Notifications

**AutoPay** sends notifications when events occur on the autopays associated with your merchant account.

To receive notifications, the merchant must expose a **POST** endpoint following the contract described in this documentation, and the merchant must be registered on the platform.

### Event types {{ id: 'event-types' }}
Currently, AutoPay sends notifications for the following events:

| Event                      | Description                                                                                                                                                      |
|----------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| AUTOPAY_CREATED            | Indicates that an autopay has been created. This may occur after the user finishes the autopay creation session and authorizes its creation.                    |
| AUTOPAY_UPDATED            | Indicates that an autopay has been updated. This may occur when the user changes the payment method, the merchant changes the payment frequency, etc.            |
| AUTOPAY_TRANSACTION_FAILED | Indicates that an automatic payment attempt has failed.                                                                                                         |
| AUTOPAY_CANCELED           | Indicates that an autopay has been canceled.                                                                                                                     |

### Webhook validation {{ id: 'validating-webhooks' }}

Since the notification arrives from a system external to your servers, it is important to validate that the message is authentic and comes from a trusted source. To do this, a signature included in the message is used, which was generated using the `secretKey` provided by the site and known only by the involved systems. To learn more about your `secretKey`, see the [Authentication](/autopay/authentication) documentation.

To start your validation, you must have the `secretKey` associated with your merchant available.

**Identify the algorithm**: To identify the algorithm used in the signature, keep the following in mind:

- If the `signature` field starts with the `sha256:` prefix, then the signature was generated using SHA-256.

**Extract the raw signature**: Once the algorithm is identified, locate the `signature` field.

- If the `sha256:` prefix is present, you must remove it to obtain the raw signature to be compared. We will call this `receivedSignature`.

**Generate your own signature**: Once the algorithm is identified, you must generate your own signature using the following formula:

- For SHA-256: `SHA-256(id + type + date + secretKey)`

This will produce the signature generated by your system, which we will call `generatedSignature`. Note that the data required to generate the signature is found in the webhook details. See more in the [Webhook contract](/autopay/contracts/webhook).

**Compare signatures**: Finally, compare the signature you generated (`generatedSignature`) with the signature received in the message (`receivedSignature`). If both signatures are equal, then the notification is authentic and you can proceed to update the session status in your system.

<Note type="warning">
    When receiving a notification, it is recommended to call the [AutoPay query API](/autopay/autopay-api) to obtain more details about the change,
    so that you always have accurate and up-to-date information.
</Note>

## Notifications {{ id: 'webhook', tag: 'POST', label: '{{baseURl}}/autopay/webhook' }}

<Note type="warning">
    **baseURL**: This is the base URL of the client/merchant application, which must be provided by the merchant and configured during the AutoPay onboarding process.
</Note>
<Row>
    <Col>
        You must expose an endpoint according to the following contract. AutoPay will send notifications to this endpoint every time an autopay is created, the payment method is updated, an autopay is canceled, or a payment fails.

        <ApiReader
            path="/autopay/webhook"
            method="POST"
            api={props.refs}
        />
    </Col>
    <Col sticky={true}>
        <CodeGroup title="Solicitud" tag="POST" label="{{baseURl}}/autopay/webhook">
            ```json {{ 'title': 'Creación de un AutoPago' }}
            {
                "id": "2972c13d-6315-4da3-80d7-64c24eb232ad",
                "reference": "ACC00012345",
                "type": "AUTOPAY_CREATED",
                "date": "2023-01-19 15:57:23",
                "signature": "sha256:a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s"
            }
            ```
            ```json {{ 'title': 'Actualización del AutoPago' }}
            {
                "id": "2972c13d-6315-4da3-80d7-64c24eb232ad",
                "reference": "ACC00012345",
                "type": "AUTOPAY_UPDATED",
                "date": "2023-01-19 15:57:23",
                "signature": "sha256:a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s"
            }
            ```

            ```json {{ 'title': 'Falla al cobrar un AutoPago' }}
            {
                "id": "2972c13d-6315-4da3-80d7-64c24eb232ad",
                "reference": "ACC00012345",
                "type": "AUTOPAY_TRANSACTION_FAILED",
                "date": "2023-01-19 15:57:23",
                "signature": "sha256:a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s",
                "additional": {
                    "transactionID": "CFed8XTioVhyG3CGHhJrpgpyM8k1phj3"
                },
            }
            ```

            ```json {{ 'title': 'Cancelación de AutoPago' }}
            {
                "id": "2972c13d-6315-4da3-80d7-64c24eb232ad",
                "reference": "ACC00012345",
                "type": "AUTOPAY_CANCELED",
                "date": "2023-01-19 15:57:23",
                "signature": "sha256:a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s"
            }
            ```
        </CodeGroup>
    </Col>
</Row>

<Row>
    <Col>
        <ApiReader
            path="/autopay/webhook"
            method="POST"
            type="response"
            api={props.refs}
        />
    </Col>
    <Col sticky>
        <br />
        <CodeGroup title="Respuesta">
            ```json {{ title: '200: Respuesta exitosa' }}
                {
                  "status": {
                     "status": "OK",
                     "reason": "00",
                     "message": "Respuesta exitosa",
                     "date": "2025-09-29T17:09:29-05:00"
                  },
                }
            ```
            ```json {{ title: '401: Firma inválida' }}
            {
                "status": {
                    "status": "FAILED",
                    "reason": "BR",
                    "message": "Firma inválida",
                    "date": "2025-09-29T17:09:29-05:00"
                },
            }
            ```
        </CodeGroup>
    </Col>
</Row>