import {ApiReader, CodeGroup, Col, Row} from "../../../../../components/mdx";
export const sectionMode = 'nav';
export const apiRefs = ['/gateway/mpi/lookup', '/gateway/mpi/query']

## 3DS Lookup {{ id: 'mpi-lookup-request', tag: 'POST', label: '/gateway/mpi/lookup' }}

Performs the initial validation process of [3DS Server](/three-d-s-server/api/integration/session), returning the data so that the user can continue with the authentication process.

<Row>
    <Col>
        <ApiReader
            path="/gateway/mpi/lookup"
            method="post"
            api={props.refs}
        />
    </Col>

    <Col sticky={true}>
        <CodeGroup title="Request" tag="POST" label="/gateway/mpi/lookup">
            ```bash {{ title: 'V2x Payment' }}
            curl -X "POST" https://api-co-dev.placetopay.ws/gateway/mpi/lookup \
            -H "Content-Type: application/json" \
            -d '{
                "auth": {
                    "login": "aabbccdd1234567890aabbccdd123456",
                    "tranKey": "ABC123example456trankey+789abc012def3456ABC=",
                    "nonce": "bmVybzNzYms4cmE=",
                    "seed": "2024-11-21T11:30:33-05:00"
                },
                "buyer": {
                    "address": {
                        "country": "CO",
                        "state": "CUN",
                        "city": "Bogota",
                        "street": "123 Example Street, Sample City, ST 12345",
                        "postalCode": "110741",
                    }
                },
                "payer": {
                    "name": "payer name",
                    "surname": "payer surname",
                    "email": "email@payer.com",
                    "mobile": "+573111111111",
                    "address": {
                        "country": "CO",
                        "state": "CUN",
                        "city": "Bogota",
                        "street": "123 Example Street, Sample City, ST 12345",
                        "postalCode": "110741",
                        "phone": "3195505452"
                    }
                },
                "payment": {
                    "reference": "1234567890",
                    "description": "Testing payment",
                    "amount": {
                        "currency": "COP",
                        "total": 20000
                    }
                },
                "instrument": {
                    "card": {
                        "number": "4111111111111111",
                        "expiration": "05/28",
                        "cvv": "123"
                    }
                },
                "returnUrl": "https://www.your-site.com/return?reference=1234567890",
                "version": "v2x",
                "additional": {
                    "initiatorIndicator": "AGENT"
                }
            }
            '
            ```

            ```bash {{ title: 'V2x Subscription' }}
            curl -X "POST" https://api-co-dev.placetopay.ws/gateway/mpi/lookup \
            -H "Content-Type: application/json" \
            -d '{
                "auth": {
                    "login": "aabbccdd1234567890aabbccdd123456",
                    "tranKey": "ABC123example456trankey+789abc012def3456ABC=",
                    "nonce": "bmVybzNzYms4cmE=",
                    "seed": "2024-11-21T11:30:33-05:00"
                },
                "userAgent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.212 Safari/537.36",
                "buyer": {
                "address": {
                        "country": "CO",
                        "state": "CUN",
                        "city": "Bogota",
                        "street": "123 Example Street, Sample City, ST 12345",
                        "postalCode": "110741",
                    }
                },
                "payer": {
                    "name": "payer name",
                    "surname": "payer surname",
                    "email": "email@payer.com",
                    "mobile": "+573111111111",
                    "address": {
                        "country": "CO",
                        "state": "CUN",
                        "city": "Bogota",
                        "street": "123 Example Street, Sample City, ST 12345",
                        "postalCode": "110741",
                        "phone": "3195505452"
                    }
                },
                "instrument": {
                    "card": {
                        "number": "4111111111111111",
                        "expiration": "05/28",
                        "cvv": "123"
                    }
                },
                "subscription": {
                    "reference": "311161",
                    "description": "Suscripción de prueba 001"
                },
                "returnUrl": "https://www.your-site.com/return?reference=1234567890",
                "version": "v2x"
            }'
            ```
            ```bash {{ title: 'V2x Merchant Risk Indicator' }}
            curl -X "POST" https://api-co-dev.placetopay.ws/gateway/mpi/lookup \
            -H "Content-Type: application/json" \
            -d '{
                "auth": {
                    "login": "aabbccdd1234567890aabbccdd123456",
                    "tranKey": "ABC123example456trankey+789abc012def3456ABC=",
                    "nonce": "bmVybzNzYms4cmE=",
                    "seed": "2024-11-21T11:30:33-05:00"
                },
                "userAgent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.212 Safari/537.36",
                "buyer": {
                    "address": {
                        "country": "CO",
                        "state": "CUN",
                        "city": "Bogota",
                        "street": "123 Example Street, Sample City, ST 12345",
                        "postalCode": "110741",
                    }
                },
                "payer": {
                    "name": "payer name",
                    "surname": "payer surname",
                    "email": "email@payer.com",
                    "mobile": "+573111111111",
                    "address": {
                        "country": "CO",
                        "state": "CUN",
                        "city": "Bogota",
                        "street": "123 Example Street, Sample City, ST 12345",
                        "postalCode": "110741",
                        "phone": "3111111111"
                    }
                },
                "payment": {
                    "reference": "1234567890",
                    "description": "Testing Payment",
                    "amount": {
                        "currency": "USD",
                        "total": 30
                    }
                },
                "instrument": {
                    "card": {
                        "number": "4111111111111111",
                        "expiration": "05/28",
                        "cvv": "123"
                    }
                },
                "returnUrl": "https://www.your-site.com/return?reference=1234567890",
                "version": "v2x",
                "metadata": {
                    "merchantRiskIndicator": {
                        "deliveryEmailAddress": "example@example.com",
                        "deliveryTimeframe": "SAME_DAY_SHIPPING",
                        "giftCardAmount": "20",
                        "giftCardCount": "01",
                        "giftCardCurrency": "USD",
                        "preOrderDate": "2025-08-28",
                        "preOrderPurchaseIndicator": "FUTURE_AVAILABILITY",
                        "reOrderItemsIndicator": "REORDERED",
                        "shipIndicator": "SHIP_TO_CARDHOLDER_BILLING_ADDR"
                    }
                }
            }'
            ```

            ```bash {{ title: 'V2x CardHolder Account Information' }}
            curl -X "POST" https://api-co-dev.placetopay.ws/gateway/mpi/lookup \
            -H "Content-Type: application/json" \
            -d '{
                "auth": {
                    "login": "aabbccdd1234567890aabbccdd123456",
                    "tranKey": "ABC123example456trankey+789abc012def3456ABC=",
                    "nonce": "bmVybzNzYms4cmE=",
                    "seed": "2024-11-21T11:30:33-05:00"
                },
                "userAgent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.212 Safari/537.36",
                "buyer": {
                    "address": {
                        "country": "CO",
                        "state": "CUN",
                        "city": "Bogota",
                        "street": "123 Example Street, Sample City, ST 12345",
                        "postalCode": "110741",
                    }
                },
                "payer": {
                    "name": "payer name",
                    "surname": "payer surname",
                    "email": "email@payer.com",
                    "mobile": "+573111111111",
                    "address": {
                        "country": "CO",
                        "state": "CUN",
                        "city": "Bogota",
                        "street": "123 Example Street, Sample City, ST 12345",
                        "postalCode": "110741",
                        "phone": "3111111111"
                    }
                },
                "payment": {
                    "reference": "1234567890",
                    "description": "Testing Payment",
                    "amount": {
                        "currency": "USD",
                        "total": 30
                    }
                },
                "instrument": {
                    "card": {
                        "number": "4111111111111111",
                        "expiration": "05/28",
                        "cvv": "123"
                    }
                },
                "returnUrl": "https://www.your-site.com/return?reference=1234567890",
                "version": "v2x",
                "metadata": {
                     "cardholderAccountInformation": {
                        "cardholderAccountDate": "2025-01-01",
                        "cardholderAccountAgeIndicator" : "BETWEEN_30_AND_60_DAYS",
                        "cardholderAccountChangeDate": "2025-02-15",
                        "cardholderAccountChangeIndicator": "LESS_30_DAYS",
                        "cardholderAccountPasswordChange": "2025-02-20",
                        "cardholderAccountPasswordChangeIndicator": "LESS_30_DAYS",
                        "cardholderPurchaseCount": "10",
                        "addCardAttemptsDay": "001",
                        "trxActivityDay": "01",
                        "trxActivityYear": "15",
                        "paymentAccountAge": "2025-02-15",
                        "paymentAccountIndicator": "LESS_30_DAYS",
                        "shipAddressUsage": "2025-02-20",
                        "shipNameIndicator": "ACCOUNT_NAME_IDENTICAL_SHIPPING_NAME",
                        "suspiciousAccountActivity": "NO_SUSPICIOUS_ACTIVITY_OBSERVED"
                    }
                }
            }'
            ```

            ```bash {{ title: 'V2 Payment' }}
            curl -X "POST" https://api-co-dev.placetopay.ws/gateway/mpi/lookup \
            -H "Content-Type: application/json" \
            -d '{
                "locale": "es_CO",
                "auth": {
                    "login":"aabbccdd1234567890aabbccdd123456",
                    "tranKey":"ABC123example456trankey+789abc012def3456ABC=",
                    "nonce":"ZGEzNHgwcGhwYm0=",
                    "seed":"2024-11-29T12:46:29-05:00"
                },
                "payer": {
                    "name": "Nombres y Apellidos",
                    "email": "email@payer.com",
                    "mobile": "+573111111111"
                },
                "payment": {
                    "reference": "1234567890",
                    "description": "Testing payment",
                    "amount": {
                        "currency": "COP",
                        "total": 20000
                    }
                },
                "instrument": {
                    "card": {
                        "number": "4111111111111111",
                        "expiration": "05/28",
                        "cvv": "123"
                    }
                },
                "returnUrl": "https://www.your-site.com/return?reference=1234567890",
                "userAgent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36",
            }'
            ```

            ```bash {{ title: 'V2 Subscription' }}
            curl -X "POST" https://api-co-dev.placetopay.ws/gateway/mpi/lookup \
            -H "Content-Type: application/json" \
            -d '{
                "locale": "es_CO",
                "auth": {
                    "login":"aabbccdd1234567890aabbccdd123456",
                    "tranKey":"ABC123example456trankey+789abc012def3456ABC=",
                    "nonce":"ZGEzNHgwcGhwYm0=",
                    "seed":"2024-11-29T12:46:29-05:00"
                },
                "payer": {
                    "name": "Nombres y Apellidos",
                    "email": "email@payer.com",
                    "mobile": "+573111111111"
                },
                "instrument": {
                    "card": {
                        "number": "4111111111111111",
                        "expiration": "05/28",
                        "cvv": "123"
                    }
                },
                "returnUrl": "https://www.your-site.com/return?reference=1234567890",
                "userAgent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36",
            }'
            ```
        </CodeGroup>
    </Col>
</Row>

<Row>
    <Col>
        <ApiReader
            path="/gateway/mpi/lookup"
            method="post"
            type="response"
            api={props.refs}
        />
    </Col>

    <Col sticky={true}>
        <br />
        <CodeGroup title="Response">
            ```json {{ title: 'V2x response (redirect)' }}
            {
                "status": {
                    "status": "OK",
                    "reason": "00",
                    "message": "The request has been successfully processed",
                    "date": "2021-09-21T12:09:36-05:00"
                },
                "data": {
                    "action": "redirect",
                    "version": "v2x",
                    "sessionToken": "658aa6f85dd76d0189f1a7d085fc7fbfb735ca408bdaf1f9973fe10d6c6e8f9b",
                    "redirectUrl": "https://3ds-server-to-authenticate.com/3ds",
                    "id": 262147
                }
            }
            ```

            ```json {{ title: 'V2x response (continue)' }}
            {
                "status": {
                    "status": "OK",
                    "reason": "00",
                    "message": "The request has been successfully processed",
                    "date": "2024-12-11T13:28:50-05:00"
                },
                "data": {
                    "action": "continue",
                    "version": "v2x",
                    "id": 263238,
                    "enrolled": "Y",
                    "authenticated": "Y",
                    "eci": "07",
                    "cavv": "AAAAAAAAAAAAAAAAAAAAAAAAAAA=",
                    "xid": "3581b9b5-d6e1-4fad-abfd-0627061fde32",
                    "extra": {
                        "transStatusReason": "88",
                        "acsTransId": "dcc1782f-4116-4eb9-beff-ae16c72413f6",
                        "threeDSServerTransID": "44587acc-7ad8-4803-a350-e297ca2c0fd9",
                        "deviceChannel": "RI",
                        "messageCategory": "PA",
                        "authMethod": "FRICTIONLESS_AUTHENTICATION",
                        "authTimestamp": "2024-12-12T00:39:17+00:00",
                        "authInd": "MASTERCARD_3RI_IS_FOR_AN_AGENT_PAYMENT_TRANSACTION"
                    },
                    "validSignature": true
                }
            }
            ```

            ```json {{ title: 'V2 Response' }}
            {
                "status": {
                    "status": "OK",
                    "reason": "00",
                    "message": "La petición se ha procesado correctamente",
                    "date": "2021-09-21T11:50:46-05:00"
                },
                "data": {
                    "version": "v2",
                    "sessionToken": "658aa6f85dd76d0189f1a7d085fc7fbfb735ca408bdaf1f9973fe10d6c6e8f9b",
                    "redirectUrl": "https://3ds-server-to-authenticate.com/3ds",
                    "identifier": "262147",
                }
            }
            ```
        </CodeGroup>
    </Col>
</Row>

---

## 3DS Query {{ id: 'mpi-query-request', tag: 'POST', label: '/gateway/mpi/query' }}

Once an authentication session is started and the necessary validations have been generated, its status can be consulted to determine if the cardholder has been correctly authenticated.

> ### Important Note
>
> *When consuming this service **the transaction is NOT** authenticated by default, the value of `data` must be taken from the response and sent in the `instrument.threeDS`*


<Row>
    <Col>

        <ApiReader
            path="/gateway/mpi/query"
            method="post"
            api={props.refs}
        />
    </Col>

    <Col sticky>
        <CodeGroup title="Request" tag="POST" label="/gateway/mpi/query">
            ```bash {{ title: 'V2x query' }}
            curl -X "POST" https://api-co-dev.placetopay.ws/gateway/mpi/lookup \
            -H "Content-Type: application/json" \
            -d '{
                "auth": {
                    "login":"aabbccdd1234567890aabbccdd123456",
                    "tranKey":"ABC123example456trankey+789abc012def3456ABC=",
                    "nonce":"NDNlZHQ5djQ3ZGs=",
                    "seed":"2024-12-11T13:28:47-05:00"
                },
                "id": 263073
            }'
            ```

            ```bash {{ title: 'V2 query' }}
            curl -X "POST" https://api-co-dev.placetopay.ws/gateway/mpi/lookup \
            -H "Content-Type: application/json" \
            -d '{
                "auth": {
                    "login":"aabbccdd1234567890aabbccdd123456",
                    "tranKey":"ABC123example456trankey+789abc012def3456ABC=",
                    "nonce":"NDNlZHQ5djQ3ZGs=",
                    "seed":"2024-12-11T13:28:47-05:00"
                },
                "instrument": {
                    "card": {
                        "number": "5180300000000005",
                        "expiration": "05/28",
                        "cvv": "123"
                    }
                },
                "id": 908652
            }'
            ```
        </CodeGroup>
    </Col>
</Row>

<Row>
    <Col>
        <ApiReader
            path="/gateway/mpi/query"
            method="post"
            type="response"
            api={props.refs}
        />
    </Col>

    <Col sticky>
        <br />
        <CodeGroup title="Response">
            ```json {{ title: 'V2x Response' }}
            {
                "status": {
                    "status": "OK",
                    "reason": "00",
                    "message": "The request has been successfully processed",
                    "date": "2024-12-11T13:28:50-05:00"
                },
                "data": {
                    "version": "v2x",
                    "id": 263238,
                    "enrolled": "Y",
                    "authenticated": "Y",
                    "eci": "05",
                    "cavv": "AAAAAAAAAAAAAAAAAAAAAAAAAAA=",
                    "xid": "3581b9b5-d6e1-4fad-abfd-0627061fde32",
                    "extra": {
                        "transStatusReason": "88",
                        "acsTransId": "dcc1782f-4116-4eb9-beff-ae16c72413f6",
                        "threeDSServerTransID": "44587acc-7ad8-4803-a350-e297ca2c0fd9",
                        "deviceChannel": "RI",
                        "messageCategory": "PA",
                        "authMethod": "FRICTIONLESS_AUTHENTICATION",
                        "authTimestamp": "2024-12-12T00:39:17+00:00",
                        "authInd": "MASTERCARD_3RI_IS_FOR_AN_AGENT_PAYMENT_TRANSACTION"
                    },
                    "validSignature": true
                }
            }
            ```

            ```json {{ title: 'V2 Response' }}
            {
                "status": {
                    "status": "OK",
                    "reason": "00",
                    "message": "The request has been successfully processed",
                    "date": "2024-12-11T13:28:50-05:00"
                },
                "data": {
                    "id": 263238,
                    "version": "v2",
                    "enrolled": "Y",
                    "authenticated": "Y",
                    "eci": "05",
                    "cavv": "AAAAAAAAAAAAAAAAAAAAAAAAAAA=",
                    "xid": "3581b9b5-d6e1-4fad-abfd-0627061fde32",
                    "extra": {
                        "transStatusReason": "88",
                        "acsTransId": "dcc1782f-4116-4eb9-beff-ae16c72413f6",
                        "threeDSServerTransID": "44587acc-7ad8-4803-a350-e297ca2c0fd9",
                    },
                    "validSignature": true
                }
            }
            ```
        </CodeGroup>
    </Col>
</Row>
