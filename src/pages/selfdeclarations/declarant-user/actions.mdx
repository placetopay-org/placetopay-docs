# Acciones
## Completar registro
Esta funcionalidad permite a los nuevos usuarios declarantes activarse en el sistema de autodeclaraciones.

<Note>
    Es importante destacar que, para que un usuario declarante pueda registrarse, primero debe ser creado por un usuario administrador, quien además debe asociarlo a una empresa y vincularlo al menos a una renta. De lo contrario, no podrá completar el registro exitosamente.
</Note>

Cuando el administrador asocia a un usuario declarante a una empresa, inmediatamente después le llega al correo registrado en el sistema una notificación para que complete el registro:

<img src="/Selfdeclarations/Declarant_user/actions/email_notification.png"/>

El usuario debe seleccionar el botón **Completar registro** para ser enviado a una nueva pantalla, donde debe ingresar los datos de la Empresa a la cual fue asociado y la información del *usuario autorizado*.

<img src="/Selfdeclarations/Declarant_user/actions/register_user_home.png"/>

Posteriormente el sistema para validar la identidad del usuario realiza un confronta que está compuesto por una serie de preguntas que el usuario debe saber responder para poder continuar con el registro.

<img src="/Selfdeclarations/Declarant_user/actions/confront.png"/>

Finalmente se le solicitan algunos datos personales que no son necesarios ingresar y una contraseña que podrá utilizar cada vez que desee ingresar al sistema.

<img src="/Selfdeclarations/Declarant_user/actions/password_registration.png"/>

## Ingreso a la plataforma
Una vez finalizado el registro, el ingreso a la plataforma se realiza mediante autenticación por OTP.

Dependiendo del sistema de autenticación que se tenga habilitado en el ambiente, el proceso cambia, a continuación se detalla cada uno de ellos.

## Autenticación por OTP
En caso de ser primer vez que se ingresa con OTP, se mostrará el siguiente mensaje.

<img src="/Selfdeclarations/Declarant_user/actions/request_OTP.png"/>

En tu correo electrónico recibirás un mensajes con el código de acceso, el cual deberás utilizar para ingresar a la plataforma, este código tendrá un tiempo de expiración para su uso.

<img src="/Selfdeclarations/Declarant_user/actions/receive_OTP.png"/>

Deberás ingresar el código de 6 dígitos en el formulario y hacer click en el botón "Ingresar". En caso de que exceda el tiempo de expiración del código, el sistema le pedirá nuevamente las credenciales de inicio de sesión para generar un nuevo código.

Una vez ingreses el código de inicio de sesión, el sistema validará el mismo y en caso de ser correcto será redirigido a la declaración o a la sección de inicio (Perfil) según corresponda

## Perfil
Esta será la pantalla de inicio al completar el registro de ingreso al sistema. Desde esta se puede visualizar la información básica del usuario.

<img src="/Selfdeclarations/Declarant_user/actions/my_profile.png"/>

### Editar
Permite al usuario modificar su información personal y de la cuenta.

Para editar el perfil se da clic en **Editar perfil**. Se abrirá el formulario con la información del usuario, allí se podrá modificar o añadir información faltante y guardar los cambios con el botón **Guardar**.

<img src="/Selfdeclarations/Declarant_user/actions/my_profile_edit.png"/>

Desde esta acción también se puede cambiar la contraseña.

Hacer clic en **Cambiar Contraseña** se desplegará un formulario en el que se solicitará la contraseña actual y la nueva contraseña. La contraseña solo se puede cambiar una vez durante cierto tiempo, el tiempo lo puede determinar un usuario administrador en la parametrización del sistema, por defecto el tiempo será 24 horas.

<img src="/Selfdeclarations/Declarant_user/actions/my_profile_edit_change_pass.png"/>

Una vez diligenciada la información se da clic **Guardar** y se ejecutarán todos los cambios.

## Impuestos
Dentro del menú, despues del perfil, se listan todos los tipos de impuestos que el usuario puede declarar o a los cuales se encuentra asociado. Independientemente del tipo de impuesto, se podrán realizar las mismas acciones para los diferentes impuestos, excepto la creación y anulación. El impuesto al registro es el único impuesto que se podrá crear y anular dentro del sistema, los otros tipos de impuestos deberán crearse consumiendo los servicios del API.

Todos los usuarios declarantes podrán crear, ver, editar, pagar, descargar y anular los impuestos de las empresas a las que están asociadas. Pero solo los usuarios con permiso podrán autorizar dichos impuestos.

<img src="/Selfdeclarations/Declarant_user/actions/incomes_list.png"/>

### Filtros
Dentro de cada impuesto se desplegarán unos filtros, que se clasifican dependiendo del estado en el que se encuentren.

- **Listado completo:** Mostrará todos los impuestos de esa categoría, independientemente del estado de estos.
- **Autorización pendiente:** Mostrará solo los impuestos que estén pendientes por autorizar.
- **Pendiente de pago:** Mostrará solo los impuestos que se encuentren en proceso o pendientes de pago.
- **Pagada:** Mostrará solo los impuestos que estén pagados.

<img src="/Selfdeclarations/Declarant_user/actions/incomes_list.png"/>

### Crear
En el impuesto al registro se pueden crear impuestos a declarar, para crear un impuesto dar clic en **Crear Impuesto Registro**, ubicado en la parte superior derecha, arriba de tabla o listado.

<img src="/Selfdeclarations/Declarant_user/actions/company_registers.png"/>

Debe seleccionar la empresa a la que se asociará la declaración. Luego se abrirá el formulario para crear el impuesto, donde deberá ingresar la información solicitada. Al final, encontrará el botón **Guardar**. Al guardar, será dirigido a la vista de detalle del impuesto.

<img src="/Selfdeclarations/Declarant_user/actions/company_register_form.png"/>

### Ver detalle
Permite acceder a la información detallada de los impuestos haciendo clic en **Ver detalles**, que está en la columna **"Opciones"**.

<img src="/Selfdeclarations/Declarant_user/actions/company_register_show_option.png"/>

Dentro del detalle se pueden ejecutar otras acciones como por ejemplo:

- **Impuesto Registro Empresa**, aquí se puede ver la información detallada del impuesto a declarar y en la parte inferior se podrán ejecutar las demás acciones.
<img src="/Selfdeclarations/Declarant_user/actions/company_register_show.png"/>

- **Listado Autorizadores**, se mostrará un listado de los usuarios que autorizaron dicho impuesto. Si no se ha autorizado aún se mostrará un mensaje informando cuantas autorizaciones necesita ese impuesto (por defecto está configurado en dos). En la parte inferior de esta pestaña también están disponibles las otras acciones.
<img src="/Selfdeclarations/Declarant_user/actions/company_registers_options_view_tab2.png"/>

- **Listado de acciones**, se verá el historial de acciones realizadas en dicho impuesto y quien ejecutó cada acción.
<img src="/Selfdeclarations/Declarant_user/actions/company_registers_options_view_tab3.png"/>

- La última pestaña solo se mostrará cuando el impuesto se encuentra pagado, además permite ver los intentos de pago realizados.
<img src="/Selfdeclarations/Declarant_user/actions/company_registers_options_view_tab4.png"/>

## Autorizar declaración
Los impuestos a declarar, después de ser creados, deben ser autorizados por un usuario asociado a la empresa que tenga permiso para autorizar, el sistema por defecto pide dos autorizaciones de usuarios distintos. La configuración del número de autorizaciones podrá ser modificado por un usuario administrador.

Para autorizar un impuesto a declarar (teniendo permisos para esto) se debe dar clic en **Autorizar**, que está en la columna **"Opciones"**.

<img src="/Selfdeclarations/Declarant_user/actions/company_register_authorize_option.png"/>

Se abrirá una ventana que solicita la contraseña del usuario, para continuar dar clic en **Confirmar** y el impuesto a declarar quedará autorizado.

<img src="/Selfdeclarations/Declarant_user/actions/company_registers_password_request_message.png"/>

Si se necesita solo una autorización el impuesto estará listo para el proceso de pago. Sin embargo si requiere mas autorizaciones, se irá inactivando la opción de autorizar para quien ya haya realizado la gestión y el impuesto quedará a la espera de que los demás autorizadores aprueben para proceder a pagar.

## Editar registro
Esta acción permite a los usuarios modificar el impuesto creado, esta opción solo estará disponible hasta que el impuestos sea autorizado, después de autorizarse *Editar registro* quedará inactivo.

Para editar un impuesto dar clic en **Editar**, que está en la columna "Opciones".

<img src="/Selfdeclarations/Declarant_user/actions/company_register_edit_option.png"/>

Se abrirá el formulario con la información ingresada durante la creación, se modifica la información y se finaliza desde **Guardar**.

<img src="/Selfdeclarations/Declarant_user/actions/company_register_edit.png"/>

## Pagar
Le permite al usuario pagar los impuestos declarados, después de haber sido autorizados.

Solo se podrá pagar un impuesto que se encuentre autorizado. Si el impuesto no ha sido autorizado, la opción de pago estará inactiva.

Para pagar un impuesto dar clic en **Pagar**, que está en la columna **"Opciones"** de la tabla o listado.

<img src="/Selfdeclarations/Declarant_user/actions/company_register_pay_options.png"/>

Se habilitará una pantalla en la que se mostrarán los medios de pago disponibles, también se puede descargar el impuesto. Para proceder con el pago dar clic en el botón **"Pagar"**.

<img src="/Selfdeclarations/Declarant_user/actions/company_registers_options_pay_screen.png"/>

El usuario será redireccionado a la plataforma de la cual puede completar el pago.

Al terminar el proceso de pago dar clic en **Volver a la página del comercio** y regresará a la pantalla donde se selecciona el método de pago, se mostrará la respuesta de la transacción y se puede descargar el impuesto.

<img src="/Selfdeclarations/Declarant_user/actions/company_registers_options_pay_status.png"/>

Al completar el pago, la acción **Pagar** dentro de la columna **"Opciones"** en la tabla o listado, cambiará de función mostrara el listado de pagos del impuesto.

## Descargar
En cualquier momento del proceso de autorización y/o pago, se podrá descargar el impuesto a declarar. Si el impuesto aún no se ha pagado, se mostrará una vista previa en la pagina, de haber sido pagado se descargará el archivo tipo PDF.

Para descargar el impuesto se debe dar clic en **Descargar**, ubicado en la columna **"Opciones"** de la tabla o listado, y el documento se descargará automáticamente.

<img src="/Selfdeclarations/Declarant_user/actions/company_register_download_option.png"/>

El archivo aparecerá en el directorio de descarga que tenga configurado en su navegador y finalmente al abrirlo, enseñará la información de la declaración gestionada.

<img src="/Selfdeclarations/Declarant_user/actions/company_register_downloaded.png"/>

## Anular
Esta acción permite a los usuarios anular la declaración de los impuestos, al anular un impuesto este no se podrá editar, autorizar, ni pagar.
<Note>
    La opción de **anular** solo estará disponible antes de que se pague el impuesto. Una vez se haya realizado el pago esta se desactivará.
</Note>

Para anular un impuesto dar clic en **Anular**, que está en la columna **"Opciones"** de la tabla o listado.

<img src="/Selfdeclarations/Declarant_user/actions/company_register_cancel_options.png"/>

Aparecerá un mensaje de confirmación, se aprueba presionando **Confirmar** y el impuesto quedará anulado.

Al ejecutar esta acción el estado del impuesto cambiará por anulado y en ese estado sólo estarán disponibles las acciones ver y descargar.
