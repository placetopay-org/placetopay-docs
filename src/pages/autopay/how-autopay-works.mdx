import { HeroPattern } from '@/components/HeroPattern'
import AutoPaySequence from "@/components/react-flow/SequenceDiagram/Diagrams/AutoPay/es/AutoPaySequence"

export const description =
  'Entiende el flujo de integraci贸n de AutoPay, el ciclo de vida de las suscripciones y c贸mo automatizar tus cobros recurrentes.'

<HeroPattern />

# C贸mo funciona AutoPay

AutoPay es una soluci贸n integral que te permite automatizar cobros recurrentes delegando en Placetopay tanto la seguridad (tokenizaci贸n PCI) como la ejecuci贸n programada de los cobros.

A diferencia de una suscripci贸n tradicional, AutoPay soporta **modelos de cobro variable** (como facturaci贸n de servicios p煤blicos o consumo) y **modelos fijos** (como membres铆as), gestionando autom谩ticamente los reintentos y la actualizaci贸n de medios de pago.

## Modelo de integraci贸n unificado

En lugar de tener que coordinar la creaci贸n de interfaces, la tokenizaci贸n de tarjetas y la configuraci贸n de reglas de cobro por separado, tu servidor solo necesita comunicarse con la API de Gateway.

El Gateway se encarga de **centralizar** la operaci贸n:

1.  **Gesti贸n de la Interfaz:** Genera autom谩ticamente la sesi贸n segura en WebCheckout para que el usuario ingrese sus datos.
2.  **Seguridad (PCI):** Asegura que los datos sensibles sean capturados y tokenizados directamente en nuestros servidores, manteniendo tu comercio fuera del alcance de auditor铆as PCI complejas.
3.  **Programaci贸n de Cobros:** Registra y activa las reglas de recurrencia (frecuencia y montos) en el motor de AutoPay para asegurar que los cobros futuros se ejecuten puntualmente.

## Conceptos clave

Para integrar AutoPay, es necesario entender dos configuraciones que definen el contrato:

### 1. Recurrencia (Recurring)
Define la "frecuencia y vida 煤til" del contrato (Periodicidad, Intervalo y Fechas de vigencia). Es fundamental configurar correctamente estos par谩metros para que el motor de cobros funcione seg煤n lo esperado.

 [**Ver gu铆a de configuraci贸n de Recurrencia**](/autopay/recurring-setup)

### 2. Tipos de cargo (Charge Type)
Define c贸mo se calcula el monto a cobrar en cada ciclo. AutoPay permite desde cobros fijos (`FIXED`) hasta consultas en tiempo real de deuda total (`TOTAL_BALANCE`) o pagos m铆nimos (`MINIMUM_BALANCE`) contra tu sistema.

 [**Ver detalle de Tipos de Cargo**](/autopay/charge-types)

## Ciclo de vida de la integraci贸n

A continuaci贸n, se describe el flujo de creaci贸n de un autopago y la ejecuci贸n posterior.

<AutoPaySequence />

### Fases del proceso

1.  **Inicializaci贸n (Setup):** Tu servidor consume la API del Gateway (`POST /session`) enviando las reglas de recurrencia. El sistema retorna una URL de redirecci贸n.
2.  **Captura y Tokenizaci贸n:** El usuario es redirigido a WebCheckout. All铆 selecciona su medio de pago, acepta los t茅rminos y la tarjeta es tokenizada de forma segura.
3.  **Confirmaci贸n:** Al finalizar, el usuario regresa a tu sitio. Debes consultar el estado de la sesi贸n para confirmar que el AutoPago fue creado (`APPROVED`).
4.  **Ejecuci贸n Programada (Futuro):**
    * El motor de AutoPay detecta cu谩ndo es el pr贸ximo cobro.
    * Si es monto variable, consulta tu API de Balance.
    * Ejecuta la transacci贸n usando el token guardado.
    * Te notifica el resultado v铆a Webhook (`AUTOPAY_TRANSACTION_FAILED` o exitosa).

### Edici贸n de un AutoPago (Actualizaci贸n)
驴Qu茅 pasa si la tarjeta del usuario vence? El flujo para **editar** una suscripci贸n reutiliza la misma integraci贸n:

1.  Creas una nueva sesi贸n en el Gateway (`POST /autopay/session`) especificando la acci贸n `EDIT` y el `id` del autopago existente.
2.  Rediriges al usuario a WebCheckout.
3.  El usuario actualiza sus datos de pago.
4.  Al finalizar, el sistema actualiza el token asociado sin perder el historial de la suscripci贸n.

## 驴Qu茅 sigue?

* [Crear una sesi贸n de AutoPago](/autopay/api/session#create-a-session)
* [Implementar los contratos de cliente](/autopay/contracts) (Para cobros variables)
* [Gesti贸n de AutoPagos](/autopay/api/session/#query-a-session) (Consulta y cancelaci贸n)