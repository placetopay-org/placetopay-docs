import { HeroPattern } from '@/components/HeroPattern'

<HeroPattern />

export const apiRefs = ['/autopay/session']


## Crear o actualizar sesión de AutoPago {{ id: 'create-a-session', tag: 'POST', label: '/autopay/session' }}

El flujo de creación y actualización de un autopago comienza con esta solicitud que genera una sessión. Este proceso permite configurar pagos programados y/o recurrentes de forma automatizada, proporcionando enlace para dirigirse a la interfaz gráfica para que el tarjeta habiente autorice el inicio o actualización del autopago y seleccione el medio de pago.

### Flujo

1. **Solicitud inicial**: Al realizar la petición de creación o edición, el sistema genera una sessión de AutoPago y retorna una URL de redirección.

2. **Interfaz de AutoPago**: La URL dirige al usuario a una interfaz gráfica donde debe:
- Aceptar los términos y condiciones del autopago
- Seleccionar su medio de pago preferido
- Completar el proceso de suscripción del medio de pago
- Pasar las validaciones de seguridad necesarias

3. **Activación**: Una vez completado el proceso, recibirá una notificación mediante webhook indicando la creación o actualización del autopago. Alternativamente, puede consultar el estado usando el endpoint de [consulta de sesión](/autopay/api/query) para verificar si el autopago ya está actualizado.

<Note type="warning">
    Esta API funciona como un **passthrough** hacia la URL de Checkout, actuando únicamente como un puente entre el comercio y Checkout, sin modificar la información enviada.

    Para mayor información sobre el comportamiento, validaciones y contratos aplicables, consulta la documentación oficial de Checkout en: [Crear sesión en Checkout](/checkout/api/reference/session/#create-a-session).
</Note>

<Row>
  <Col>
    <ApiReader
      path="/autopay/session"
      method="post"
      api={props.refs}
    />
  </Col>
  <Col sticky>
    <CodeGroup title="Solicitud" tag="POST" label="/autopay/session">

```bash {{ title: 'Sesión para crear autopago - Monto Fijo' }}
curl -X "POST" {{baseURl}}/autopay/session \
  -H "Content-Type: application/json" \
  -d '{
    "auth": {
      "login": "aabbccdd1234567890aabbccdd123456",
      "tranKey": "ABC123example456trankey+789abc012def3456ABC=",
      "nonce": "NjE0OWVkODgwYjNhNw==",
      "seed": "2021-09-21T09:34:48-05:00"
    },
    "type": "autopay",
    "autopay": {
      "action": "CREATE",
      "reference": "12345",
      "description": "Inscripción autopago monto fijo",
      "dueDay": 15,
      "recurring": {
        "type": "FIXED",
        "periodicity": "M",
        "interval": "1",
        "maxPeriods": 12,
        "startDate": "2026-11-26",
        "nextPayment": "2026-12-05",
        "dueDate": "2027-11-26",
        "notificationUrl": "https://merchant.test/notification",
      },
      "amount": {
        "currency": "USD",
        "total": 100
      }
    },
    "returnUrl": "https://merchant.test/return",
    "ipAddress": "127.0.0.1",
    "userAgent": "PlacetoPay Sandbox",
  }'
```

```bash {{ title: 'Sesión para crear autopago - Monto Total' }}
curl -X "POST" {{baseURl}}/autopay/session \
  -H "Content-Type: application/json" \
  -d '{
    "auth": {
      "login": "aabbccdd1234567890aabbccdd123456",
      "tranKey": "ABC123example456trankey+789abc012def3456ABC=",
      "nonce": "NjE0OWVkODgwYjNhNw==",
      "seed": "2021-09-21T09:34:48-05:00"
    },
    "type": "autopay",
    "autopay": {
      "action": "CREATE",
      "reference": "12345",
      "description": "Inscripción autopago monto fijo",
      "dueDay": 15
      "recurring": {
        "type": "TOTAL_BALANCE",
        "periodicity": "M",
        "interval": "1",
        "maxPeriods": 12,
        "startDate": "2026-11-26",
        "nextPayment": "2026-12-05",
        "dueDate": "2027-11-26",
        "notificationUrl": "https://merchant.test/notification",
      }
    },
    "returnUrl": "https://merchant.test/return",
    "ipAddress": "127.0.0.1",
    "userAgent": "PlacetoPay Sandbox",
  }'
```

```bash {{ title: 'Sesión para crear autopago - Monto Mínimo' }}
curl -X "POST" {{baseURl}}/autopay/session \
  -H "Content-Type: application/json" \
  -d '{
    "auth": {
      "login": "aabbccdd1234567890aabbccdd123456",
      "tranKey": "ABC123example456trankey+789abc012def3456ABC=",
      "nonce": "NjE0OWVkODgwYjNhNw==",
      "seed": "2021-09-21T09:34:48-05:00"
    },
    "type": "autopay",
    "autopay": {
      "action": "CREATE",
      "reference": "12345",
      "description": "Inscripción autopago monto fijo",
      "dueDay": 15
      "recurring": {
        "type": "MINIMUM_BALANCE",
        "periodicity": "M",
        "interval": "1",
        "maxPeriods": 12,
        "startDate": "2026-11-26",
        "nextPayment": "2026-12-05",
        "dueDate": "2027-11-26",
        "notificationUrl": "https://merchant.test/notification",
      }
    },
    "returnUrl": "https://merchant.test/return",
    "ipAddress": "127.0.0.1",
    "userAgent": "PlacetoPay Sandbox",
  }'
```

```bash {{ title: 'Sesión para editar autopago' }}
curl -X "POST" {{baseURl}}/autopay/session \
  -H "Content-Type: application/json" \
  -d '{
    "auth": {
      "login": "aabbccdd1234567890aabbccdd123456",
      "tranKey": "ABC123example456trankey+789abc012def3456ABC=",
      "nonce": "NjE0OWVkODgwYjNhNw==",
      "seed": "2021-09-21T09:34:48-05:00"
    },
    "type": "autopay",
    "autopay": {
      "action": "EDIT",
      "reference": "12345",
      "description": "Inscripción autopago monto fijo",
      "id": "f7b347d7-c922-4c68-8750-99fb43c9e5ff"
    },
    "returnUrl": "https://merchant.test/return",
    "ipAddress": "127.0.0.1",
    "userAgent": "PlacetoPay Sandbox",
  }'
```
    </CodeGroup>
  </Col>
</Row>

<Row>
  <Col>
    <ApiReader
      path="/autopay/session"
      method="post"
      type="response"
      api={props.refs}
    />
  </Col>

  <Col sticky>
    <br />
    <CodeGroup title="Respuesta">
```json {{ title: '200' }}
{
  "status": {
    "status": "OK",
    "reason": "00",
    "message": "La petición se ha procesado correctamente",
    "date": "2021-11-30T15:08:27-05:00"
  },
  "requestId": 1,
  "processUrl": "https://checkout-co.placetopay.com/session/1/cc9b8690b1f7228c78b759ce27d7e80a",
}
```
```json {{ title: '400' }}
{
  "status": {
    "status": "FAILED",
    "reason": 400,
    "message": "Autenticación fallida 102",
    "date": "2021-11-30T15:12:25-05:00"
  },
}
```
    </CodeGroup>
  </Col>
</Row>