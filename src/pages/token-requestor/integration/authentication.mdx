# Autenticación


Para interactuar con la API de Token Requestor debe autenticar sus peticiones, de esta
forma identificamos y validamos la información para que sus operaciones sean seguras.
La API utiliza Web Services Security Username Token Profile 1.1.

## Credenciales API

En la integración con Token Requestor usted debe contar con las credenciales login y secretKey
de consumidor.

- **login:** Identificador del sitio, puede considerarse público, pues viaja como dato plano
en las peticiones API.
- **secretKey:** Llave secreta del sitio, debe ser privada, a partir de este dato se
generará un nuevo tranKey que será enviado en las peticiones.

<Note>
    Estas credenciales son propias del sitio y deben ser tratadas de forma segura. No
    comparta sus credenciales en áreas de acceso público como Github, código del lado de
    cliente u otros lugares de fácil acceso para terceros.
</Note>

## Objeto Authentication
El parámetro auth debe ser enviado en todas las peticiones API y contiene el grupo de
propiedades necesarias para verificar la autenticación.

### Solicitud

| Campo             |                                                                 | Tipo   | Descripción                                                                                                                                                                                                      | Ejemplo                                      |
|-------------------|-----------------------------------------------------------------|--------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------|
| **auth.** login   | <span class="text-teal-500 dark:text-teal-400">REQUERIDO</span> | string | Identificador del sitio                                                                                                                                                                                          | 1441d14df19ec88431e513bb990326e1             |
| **auth.** tranKey | <span class="text-teal-500 dark:text-teal-400">REQUERIDO</span> | string | Se genera en cada solicitud de forma programática.<br/>Se construye con la fórmula:<br/>`Base64(SHA-256(nonce + seed + secretKey))`<br/>Esta fórmula debe adaptarse según el lenguaje de programación utilizado. | DGYymv6ohpYwtLWon/iADE/COoo9JXt4jqyk6D006PY= |
| **auth.** nonce   | <span class="text-teal-500 dark:text-teal-400">REQUERIDO</span> | string | Valor aleatorio para cada solicitud codificado en Base64.                                                                                                                                                        | enQ4dXh3YWhkMWM=                             |
| **auth.** seed    | <span class="text-teal-500 dark:text-teal-400">REQUERIDO</span> | string | Fecha en la que se generó la autenticación, en formato ISO 8601.                                                                                                                                                 | 2023-06-21T09:56:06-05:00                    |



```json
    {
      "auth": {
        "login": "1441d14df19ec88431e513bb990326e1",
        "tranKey": "DGYymv6ohpYwtLWon/iADE/COoo9JXt4jqyk6D006PY=",
        "nonce": "enQ4dXh3YWhkMWM=",
        "seed": "2023-06-21T09:56:06-05:00"
      }
    }

```

## Cómo generar tu autenticación
El parámetro `auth` debe ser enviado en todas las peticiones API y contiene el grupo de
propiedades necesarias para verificar la autenticación.

```php

    $login = "customerLogin";
    $secretKey = "customerSecretKey";
    $seed = date('c');
    $rawNonce = rand();
    $tranKey = base64_encode(hash('sha256', $rawNonce.$seed.$secretKey, true));
    $nonce = base64_encode($rawNonce);

    $body = [
        "auth" => [
        "login" => $login,
        "tranKey" => $tranKey,
        "nonce" => $nonce,
         "seed" => $seed,
     ],
     // ... other params
    ];

```

## Posibles errores de autenticación

| Código | Causa                                                                       |
|--------|-----------------------------------------------------------------------------|
| 100    | UsernameToken no proporcionado (Encabezado de la autorización mal formada). |
| 101    | El identificador del consumidor no existe.                                  |
| 102    | El hash de TranKey no coincide, puede ser incorrecto o mal formado.         |
| 103    | Fecha del seed mayor de 5 minutos.                                          |
| 104    | Consumidor inactivo                                                         |

