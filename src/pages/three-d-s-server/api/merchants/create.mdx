export const sectionMode = 'nav';

export const description = 'En esta página, nos sumergiremos en los diferentes puntos finales de 3DSS que puede usar para administrar los comercios mediante programación.';

export const apiRefs = ['/api/v1/merchants'];

# API Comercios


## Crear un comercio {{ id: 'create-a-merchant', tag: 'POST', label: '/api/{version}/merchants' }}

<Row>
  <Col>
      <ApiReader
        path="/api/v1/merchants"
        method="POST"
        api={props.refs}
      />
  </Col>

  <Col sticky={true}>
        <CodeGroup title="Solicitud" tag="POST" label="/api/{version}/merchants">
            ```bash {{ title: 'V1' }}
            curl -X "POST" https://3dss-test.placetopay.com/api/v1/merchants \
              -H "Content-Type: application/json" \
              -H "Accept: application/json" \
              -H "Authorization: Bearer ACCESS_TOKEN" \
              -d '{
                      "name": "Comercio uno",
                      "brand": "Marca comercio uno",
                      "country": "COL",
                      "currency": "COP",
                      "url": "https://www.comercio.com",
                      "mcc": 742,
                      "isicClass": 111,
                      "document": {
                          "type": "NIT",
                          "number": "1234567895"
                      },
                      "subscriptions": [
                          {
                              "franchise": "visa",
                              "acquirerBIN": "411111",
                              "version": 2,
                              "merchantCode": "1234"
                          },
                          {
                              "franchise": "mastercard",
                              "acquirerBIN": "510510",
                              "version": 2,
                              "merchantCode": "1234"
                          }
                      ],
                      "branches": [
                          {
                              "name": "Sucursal uno",
                              "brand": "Marca de la sucursal uno",
                              "country": "COL",
                              "currency": "COP",
                              "url": "https://www.sucursal1.comercio.com",
                              "enabled": true,
                              "subscriptions": [
                                  {
                                      "franchise": "visa",
                                      "acquirerBIN": "411111",
                                      "version": 2,
                                      "merchantCode": "1234"
                                  },
                                  {
                                      "franchise": "mastercard",
                                      "acquirerBIN": "510510",
                                      "version": 2,
                                      "merchantCode": "1234"
                                  }
                              ]
                          },
                          {
                              "name": "Sucursal dos",
                              "brand": "Marca de la sucursal dos",
                              "country": "COL",
                              "currency": "COP",
                              "url": "https://www.sucursal2.comercio.com",
                              "enabled": true,
                              "subscriptions": [
                                  {
                                      "franchise": "1",
                                      "acquirerBIN": "411111",
                                      "version": 2,
                                      "merchantCode": "1234"
                                  }
                              ]
                          }
                      ],
                      "invitations": []
                  }'
            ```
            ```bash {{ title: 'V2' }}
            curl -X "POST" https://3dss-test.placetopay.com/api/v2/merchants \
              -H "Content-Type: application/json" \
              -H "Accept: application/json" \
              -H "Authorization: Bearer ACCESS_TOKEN" \
              -d '{
                      "name": "Comercio uno",
                      "brand": "Marca comercio uno",
                      "country": "COL",
                      "currency": "COP",
                      "url": "https://www.comercio.com",
                      "mcc": 742,
                      "isicClass": 111,
                      "document": {
                          "type": "NIT",
                          "number": "1234567895"
                      },
                      "subscriptions": [
                          {
                              "franchise": "visa",
                              "acquirerBIN": "411111",
                              "version": 2,
                              "merchantCode": "1234"
                          },
                          {
                              "franchise": "mastercard",
                              "acquirerBIN": "510510",
                              "version": 2,
                              "merchantCode": "1234"
                          }
                      ],
                      "branches": [
                          {
                              "name": "Sucursal uno",
                              "brand": "Marca de la sucursal uno",
                              "country": "COL",
                              "currency": "COP",
                              "url": "https://www.sucursal1.comercio.com",
                              "enabled": true,
                              "createToken": true,
                              "subscriptions": [
                                  {
                                      "franchise": "visa",
                                      "acquirerBIN": "411111",
                                      "version": 2,
                                      "merchantCode": "1234"
                                  },
                                  {
                                      "franchise": "mastercard",
                                      "acquirerBIN": "510510",
                                      "version": 2,
                                      "merchantCode": "1234"
                                  }
                              ]
                          },
                          {
                              "name": "Sucursal dos",
                              "brand": "Marca de la sucursal dos",
                              "country": "COL",
                              "currency": "COP",
                              "url": "https://www.sucursal2.comercio.com",
                              "enabled": true,
                              "createToken": true,
                              "subscriptions": [
                                  {
                                      "franchise": "1",
                                      "acquirerBIN": "411111",
                                      "version": 2,
                                      "merchantCode": "1234"
                                  }
                              ]
                          }
                      ],
                      "invitations": []
                  }'
            ```
        </CodeGroup>
  </Col>
</Row>

<Row>
  <Col>
    <ApiReader
      path="/api/v1/merchants"
      method="POST"
      type="response"
      api={props.refs}
    />
  </Col>

  <Col sticky={true}>
    <br />
    <CodeGroup title="Respuesta">
    ```json {{ title: '200 (V1)' }}
    {
      "status": {
        "code":1000
      },
      "data": {
        "merchant": {
          "id":1,
          "name":"Comercio uno",
          "token":"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9...",
          "expires_at": "2024-09-16 15:30:45"
        },
        "branches":[
          {
            "id":1,
            "name":"Sucursal uno",
            "token":"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9...",
            "expires_at": "2024-09-16 15:30:45"
          },
          {
             "id":2,
             "name":"Sucursal dos",
             "token":"eyJ0eXAiOiJKV19.eyJhdWQiOiIxIiwianRpIjoiMWIyNjgk867nh...............",
             "expires_at": "2024-09-16 15:30:45"
          }
        ]
      }
    }
    ```

    ```json {{ title: '200 (V2)' }}
    {
        "status": {
            "status": "OK",
            "reason": "00",
            "message": "The request has been successfully processed",
            "date": "2025-12-09T20:46:20+00:00"
        },
        "merchant": {
          "id":1,
          "name":"Comercio uno"
        },
        "branches":[
          {
            "id":1,
            "name":"Sucursal uno",
            "token": {
                "accessToken":"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9...",
                "expiresAt": "2028-12-09T20:46:20+00:00",
            }
          },
          {
             "id":2,
             "name":"Sucursal dos",
             "token": {
                 "accessToken":"eyJ0eXAiOiJKV19.eyJhdWQiOiIxIiwianRpIjoiMWIyNjgk867nh...............",
                 "expiresAt": "2028-12-09T20:46:20+00:00",
             }
          }
        ]

    }
    ```

    ```json {{ title: '401 (V1)' }}
    {
      "message": "Unauthenticated."
    }
    ```

    ```json {{ title: '401 (V2)' }}
    {
        "status": {
            "status": "FAILED",
            "reason": "BR",
            "message": "Unauthenticated.",
            "date": "2025-12-09T20:58:15+00:00"
        }
    }
    ```

    ```json {{ title: '422 (V1)' }}
    {
      "status": {
        "code": 1003,
        "error": "The name has already been taken."
      }
    }
    ```

    ```json {{ title: '422 (V2)' }}
    {
        "status": {
            "status": "FAILED",
            "reason": "BR",
            "message": "The branches.0.name has already been taken.",
            "date": "2025-12-09T21:00:42+00:00"
        }
    }
    ```
    </CodeGroup>
  </Col>
</Row>

## Especificaciones de Campos y Reglas para Merchant, Branches, Subscriptions e Invitations

---
| **Campo**                                               | **Requerido** | **Tipo** | **Longitud**             | **Reglas Adicionales**                                                                                                               | **Debe Existir en**                         | **Formato/Validación**                         |
|---------------------------------------------------------|---------------|----------|--------------------------|--------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------|------------------------------------------------|
| **name**                                                | Sí            | String   | Máx. 90 caracteres       | Único (MerchantUnique)                                                                                                               |                                             |                                                |
| **brand**                                               | No            | String   | Máx. 25 caracteres       |                                                                                                                                      |                                             |                                                |
| **country**                                             | Sí            | String   | Exactamente 3 caracteres | Tabla countries, columna alpha_3_code                                                                                                | Tabla countries, columna alpha_3_code       |                                                |
| **currency**                                            | Sí            | String   |                          | Tabla currencies, columna alphabetic_code                                                                                            | Tabla currencies, columna alphabetic_code   |                                                |
| **url**                                                 | Sí            | String   | Máx. 90 caracteres       | URL válida (ValidUrlRule)                                                                                                            |                                             | URL válida                                     |
| **mcc**                                                 | Sí            | Numérico |                          | Tabla merchant_category_codes, columna code                                                                                          | Tabla merchant_category_codes, columna code |                                                |
| **isicClass**                                           | No            | Numérico |                          | Tabla isic_classes, columna code document                                                                                            | Tabla isic_classes, columna code document   |                                                |
| **type**                                                | No            | String   |                          | Tabla document_types, columna name                                                                                                   | Tabla document_types, columna name          |                                                |                                                                                                                           |                                             |                                                |
| **number**                                              | No            | String   |                          | Dependiente del tipo de documento                                                                                                    |                                             | Patrón regex dependiente del tipo de documento |
| **subscriptions[n].<br/>franchise**                     | Sí            | String   |                          | Tabla franchises, columna brand(name), Validaciones personalizadas (FranchiseEnabled, DirectoryServerExists, DirectoryServerEnabled) | Tabla franchises, columna brand(name)       |                                                |
| **subscriptions[n].<br/>acquirerBIN**                   | Sí            | Numérico |                          | Validaciones personalizadas (AcquirerBinExists, AcquirerEnabled)                                                                     |                                             |                                                |
| **subscriptions[n].<br/>version**                       | Sí            | Numérico | 1                        | Valores permitidos: Definidos en Protocol                                                                                            |                                             |                                                |
| **subscriptions[n].<br/>merchantCode**                  | Sí            | String   |                          |                                                                                                                                      |                                             |                                                |
| **branches[n].<br/>name**                               | Sí            | String   | Máx. 90 caracteres       | Único (BranchUnique)                                                                                                                 |                                             |                                                |
| **branches[n].<br/>brand**                              | Sí            | String   | Máx. 25 caracteres       |                                                                                                                                      |                                             |                                                |
| **branches[n].<br/>country**                            | Sí            | String   | Exactamente 3 caracteres | Tabla countries, columna alpha_3_code                                                                                                | Tabla countries, columna alpha_3_code       |                                                |
| **branches[n].<br/>currency**                           | Sí            | String   |                          | Tabla currencies, columna alphabetic_code                                                                                            | Tabla currencies, columna alphabetic_code   |                                                |
| **branches[n].<br/>enabled**                            | No            | Booleano |                          |                                                                                                                                      |                                             |                                                |                                                                                                                               |                                             |                                                |
| **branches[n].<br/>subscriptions[n].<br/>franchise**    | Sí            | String   |                          | Tabla franchises, columna brand(name), Validaciones personalizadas (FranchiseEnabled, DirectoryServerExists, DirectoryServerEnabled) | Tabla franchises, columna brand(name)       |                                                |
| **branches[n].<br/>subscriptions[n].<br/>acquirerBIN**  | Sí            | Numérico |                          | Validaciones personalizadas (AcquirerBinExists, AcquirerEnabled)                                                                     |                                             |                                                |
| **branches[n].<br/>subscriptions[n].<br/>merchantCode** | Sí            | String   |                          |                                                                                                                                      |                                             |                                                |
| **branches[n].<br/>subscriptions[n].<br/>version**      | No            | Numérico | 1                        |                                                                                                                                      |                                             |                                                |
| **invitations[n]**                                      | Sí            | String   | Máx. 255 caracteres      | Email válido                                                                                                                         |                                             | Email válido                                   |

## Descripción de Validaciones y Reglas Adicionales

- **MerchantUnique:** El valor en el campo `name` debe ser único en la base de datos.
- **ValidUrlRule:** El campo `url` debe ser una URL válida.
- **FranchiseEnabled:** Validación personalizada para verificar si la franquicia está habilitada.
- **DirectoryServerExists:** Verificación de la existencia del servidor de directorio.
- **DirectoryServerEnabled:** Verificación de que el servidor de directorio está habilitado.
- **AcquirerBinExists:** Verificación de la existencia del BIN del adquirente.
- **AcquirerEnabled:** Verificación de que el adquirente está habilitado.
- **Protocol:** Define los valores permitidos para el campo `version`.
- **BranchUnique:** El valor en el campo `branches[n].name` debe ser único para cada sucursal.
- **Email válido:** El campo `invitations[n]` debe ser una dirección de correo electrónico válida.

Esta tabla cubre todos los campos y sus respectivas reglas para cada sección que has mencionado. Puedes ajustarla según las especificaciones de tu sistema.
